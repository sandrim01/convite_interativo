{% extends "base.html" %}

{% block content %}
<div class="convite-container">
    <!-- Capa do Convite -->
    <div class="carta-envelope" id="envelope">
        <div class="envelope-front">
            <div class="envelope-content">
                <h1 class="nomes-noivos">Alessandro & [Nome da Noiva]</h1>
                <p class="texto-convite">Convidam voc√™ para celebrar nosso amor</p>
                <button class="btn-abrir btn-destacado" onclick="abrirConvite()">
                    <i class="fas fa-envelope-open"></i>
                    Abrir Convite
                </button>
            </div>
        </div>
    </div>

    <!-- Carta do Convite -->
    <div class="carta-content" id="carta" style="display: none;">
        <div class="carta-header">
            <div class="ornamento-top"></div>
            <h2 class="titulo-casamento">Nosso Casamento</h2>
            <div class="coracao">‚ù§Ô∏è</div>
        </div>

        <div class="carta-body">
            <div class="secao-nomes">
                <h1 class="nomes-principais">Alessandro & [Nome da Noiva]</h1>
                <p class="subtitulo">T√™m o prazer de convid√°-lo(a) para celebrar nossa uni√£o</p>
            </div>

            <div class="secao-data" id="secao-data">
                <div class="info-evento">
                    <h3><i class="fas fa-calendar-alt"></i> Data & Hor√°rio</h3>
                    <div class="data-info">
                        <p class="data">S√°bado, 15 de Setembro de 2024</p>
                        <p class="horario">√†s 18:00 horas</p>
                    </div>
                    <button class="btn-acao btn-destacado" onclick="mostrarLocal()">
                        <i class="fas fa-map-marker-alt"></i>
                        Ver Local da Cerim√¥nia
                    </button>
                </div>
            </div>

            <div class="secao-local" id="secao-local" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-church"></i> Local da Cerim√¥nia</h3>
                    <div class="local-info">
                        <p class="nome-local">Igreja S√£o Jos√©</p>
                        <p class="endereco">Rua das Flores, 123 - Centro<br>S√£o Paulo - SP</p>
                    </div>
                    <div class="mapa-container">
                        <div id="mapa" style="height: 300px; border-radius: 10px;"></div>
                    </div>
                    <div class="acoes-local">
                        <button class="btn-acao" onclick="abrirGoogleMaps()">
                            <i class="fas fa-directions"></i>
                            Como Chegar
                        </button>
                        <button class="btn-acao" onclick="mostrarRecepcao()">
                            <i class="fas fa-glass-cheers"></i>
                            Ver Local da Recep√ß√£o
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-recepcao" id="secao-recepcao" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-glass-cheers"></i> Recep√ß√£o</h3>
                    <div class="local-info">
                        <p class="nome-local">Sal√£o de Festas Elegance</p>
                        <p class="endereco">Av. dos Noivos, 456 - Jardim Felicidade<br>S√£o Paulo - SP</p>
                        <p class="horario-recepcao">A partir das 19:30</p>
                    </div>
                    <div class="acoes-recepcao">
                        <button class="btn-acao" onclick="abrirGoogleMapsRecepcao()">
                            <i class="fas fa-directions"></i>
                            Como Chegar
                        </button>
                        <button class="btn-acao" onclick="mostrarConfirmacao()">
                            <i class="fas fa-heart"></i>
                            Confirmar Presen√ßa
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-confirmacao" id="secao-confirmacao" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-heart"></i> Confirma√ß√£o de Presen√ßa</h3>
                    <form id="form-confirmacao" class="form-confirmacao">
                        <div class="form-group">
                            <label for="nome">Nome Completo:</label>
                            <input type="text" id="nome" name="nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">E-mail:</label>
                            <input type="email" id="email" name="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="telefone">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone">
                        </div>
                        
                        <div class="form-group">
                            <label>Confirma sua presen√ßa?</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="presenca" value="true" required>
                                    <span>Sim, estarei presente! üéâ</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="presenca" value="false" required>
                                    <span>Infelizmente n√£o poderei comparecer üò¢</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="acompanhantes">N√∫mero de acompanhantes:</label>
                            <select id="acompanhantes" name="acompanhantes">
                                <option value="0">Apenas eu</option>
                                <option value="1">1 acompanhante</option>
                                <option value="2">2 acompanhantes</option>
                                <option value="3">3 acompanhantes</option>
                                <option value="4">4 ou mais acompanhantes</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes (opcional):</label>
                            <textarea id="observacoes" name="observacoes" rows="3" placeholder="Alguma restri√ß√£o alimentar ou observa√ß√£o especial?"></textarea>
                        </div>
                        
                        <div class="acoes-confirmacao">
                            <button type="submit" class="btn-confirmar btn-destacado">
                                <i class="fas fa-check"></i>
                                Confirmar Presen√ßa
                            </button>
                            <button type="button" class="btn-acao" onclick="mostrarPresentes()">
                                <i class="fas fa-gift"></i>
                                Ver Lista de Presentes
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="secao-presentes" id="secao-presentes" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-gift"></i> Lista de Presentes</h3>
                    <p class="texto-presentes">
                        Sua presen√ßa √© o presente mais importante para n√≥s! <br>
                        Mas se desejar nos presentear, preparamos uma lista especial:
                    </p>
                    <div class="acoes-presentes">
                        <a href="{{ url_for('lista_presentes') }}" class="btn-presentes" target="_blank">
                            <i class="fab fa-amazon"></i>
                            Ver Lista de Presentes
                        </a>
                        <button class="btn-acao" onclick="mostrarAgradecimentos()">
                            <i class="fas fa-heart"></i>
                            Mensagem Final
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-agradecimentos" id="secao-agradecimentos" style="display: none;">
                <div class="info-evento final">
                    <div class="coracao-grande">üíï</div>
                    <h3>Obrigado!</h3>
                    <p class="mensagem-final">
                        Esperamos celebrar este momento especial ao seu lado.<br>
                        Sua presen√ßa tornar√° nosso dia ainda mais especial!
                    </p>
                    <div class="assinatura">
                        <p>Com amor,<br><strong>Alessandro & [Nome da Noiva]</strong></p>
                    </div>
                    <button class="btn-acao" onclick="voltarAoInicio()">
                        <i class="fas fa-redo"></i>
                        Voltar ao In√≠cio
                    </button>
                    
                    <!-- Link discreto para administra√ß√£o -->
                    <div class="admin-access" style="margin-top: 30px; text-align: center;">
                        <a href="{{ url_for('admin_login') }}" class="admin-link">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Sucesso -->
<div id="modal-sucesso" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <div class="modal-body">
            <i class="fas fa-check-circle modal-icon"></i>
            <h3>Confirma√ß√£o Enviada!</h3>
            <p>Obrigado por confirmar sua presen√ßa. Aguardamos voc√™ em nosso grande dia!</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Configura√ß√£o do Google Maps
const coordenadas = {
    cerimonia: { lat: -23.5505, lng: -46.6333 }, // Coordenadas de exemplo - S√£o Paulo
    recepcao: { lat: -23.5489, lng: -46.6388 }   // Coordenadas de exemplo - S√£o Paulo
};

function initMap() {
    // Mapa da cerim√¥nia
    const map = new google.maps.Map(document.getElementById("mapa"), {
        zoom: 15,
        center: coordenadas.cerimonia,
    });
    
    const marker = new google.maps.Marker({
        position: coordenadas.cerimonia,
        map: map,
        title: "Igreja S√£o Jos√©"
    });
}

// Fun√ß√µes de navega√ß√£o
function abrirConvite() {
    document.getElementById('envelope').style.display = 'none';
    document.getElementById('carta').style.display = 'block';
}

function mostrarLocal() {
    document.getElementById('secao-local').style.display = 'block';
    document.getElementById('secao-local').scrollIntoView({ behavior: 'smooth' });
    // Inicializar o mapa ap√≥s mostrar a se√ß√£o
    setTimeout(initMap, 500);
}

function mostrarRecepcao() {
    document.getElementById('secao-recepcao').style.display = 'block';
    document.getElementById('secao-recepcao').scrollIntoView({ behavior: 'smooth' });
}

function mostrarConfirmacao() {
    document.getElementById('secao-confirmacao').style.display = 'block';
    document.getElementById('secao-confirmacao').scrollIntoView({ behavior: 'smooth' });
}

function mostrarPresentes() {
    document.getElementById('secao-presentes').style.display = 'block';
    document.getElementById('secao-presentes').scrollIntoView({ behavior: 'smooth' });
}

function mostrarAgradecimentos() {
    document.getElementById('secao-agradecimentos').style.display = 'block';
    document.getElementById('secao-agradecimentos').scrollIntoView({ behavior: 'smooth' });
}

function voltarAoInicio() {
    // Esconder todas as se√ß√µes
    document.querySelectorAll('.secao-local, .secao-recepcao, .secao-confirmacao, .secao-presentes, .secao-agradecimentos').forEach(el => {
        el.style.display = 'none';
    });
    
    // Voltar para o topo
    document.getElementById('secao-data').scrollIntoView({ behavior: 'smooth' });
}

function abrirGoogleMaps() {
    const url = `https://maps.google.com/?q=${coordenadas.cerimonia.lat},${coordenadas.cerimonia.lng}`;
    window.open(url, '_blank');
}

function abrirGoogleMapsRecepcao() {
    const url = `https://maps.google.com/?q=${coordenadas.recepcao.lat},${coordenadas.recepcao.lng}`;
    window.open(url, '_blank');
}

// Formul√°rio de confirma√ß√£o
document.getElementById('form-confirmacao').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        nome: formData.get('nome'),
        email: formData.get('email'),
        telefone: formData.get('telefone'),
        confirmou_presenca: formData.get('presenca') === 'true',
        acompanhantes: parseInt(formData.get('acompanhantes')),
        observacoes: formData.get('observacoes')
    };
    
    try {
        const response = await fetch('/api/confirmar-presenca', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('modal-sucesso').style.display = 'block';
            this.reset();
        } else {
            alert('Erro ao enviar confirma√ß√£o: ' + result.message);
        }
    } catch (error) {
        alert('Erro ao enviar confirma√ß√£o. Tente novamente.');
    }
});

function fecharModal() {
    document.getElementById('modal-sucesso').style.display = 'none';
}

// Fechar modal clicando fora dele
window.onclick = function(event) {
    const modal = document.getElementById('modal-sucesso');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>

<!-- Script do Google Maps -->
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_DO_GOOGLE_MAPS&callback=initMap">
</script>
{% endblock %}
