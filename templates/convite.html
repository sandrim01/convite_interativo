{% extends "base.html" %}

<!-- 
    CONVITE INTERATIVO DE CASAMENTO - SAMUEL & IARA
    Design Elegante v2.0 - Inspirado em convites cl√°ssicos
    Data de atualiza√ß√£o: 28/07/2025
-->

{% block content %}
<div class="convite-container">
    <!-- Tela de Identifica√ß√£o (apenas quando n√£o h√° c√≥digo ou c√≥digo inv√°lido) -->
    {% if not convidado %}
    <div class="identificacao-container" id="identificacao">
        <div class="identificacao-content">
            <div class="coracao-welcome">üíï</div>
            <h1 class="titulo-identificacao">Samuel & Iara</h1>
            
            {% if erro_codigo %}
            <div class="alert alert-error">
                <i class="fas fa-exclamation-triangle"></i>
                Link de convite inv√°lido. Verifique o c√≥digo ou informe seus dados:
            </div>
            {% else %}
            <p class="subtitulo-identificacao">Para personalizar seu convite, informe:</p>
            {% endif %}
            
            <form id="form-identificacao" class="form-identificacao">
                <div class="form-group">
                    <label for="identificador">Seu nome ou WhatsApp:</label>
                    <input type="text" id="identificador" name="identificador" 
                           placeholder="Ex: Jo√£o Silva ou 11999999999" required>
                </div>
                
                <button type="submit" class="btn-identificar btn-destacado">
                    <i class="fas fa-search"></i>
                    Buscar meu convite
                </button>
            </form>
            
            <div class="identificacao-alternativa">
                <p>N√£o est√° cadastrado?</p>
                <button class="btn-continuar-generico" onclick="continuarGenerico()">
                    <i class="fas fa-envelope"></i>
                    Continuar sem personaliza√ß√£o
                </button>
            </div>
        </div>
    </div>
    {% else %}
    
    <!-- Convite Personalizado (quando h√° convidado v√°lido) -->
    <div class="convite-personalizado">
        <!-- Design Inspirado na Imagem -->
        <div class="convite-elegante" id="envelope">
            <!-- Fundo ornamental -->
            <div class="background-ornament"></div>
            
            <!-- Conte√∫do principal -->
            <div class="main-content">
                <!-- Se√ß√£o das fotos -->
                <div class="photos-section">
                    <div class="photo-frame samuel-frame">
                        <img src="/static/images/samuel-photo.jpg" alt="Samuel" onerror="this.parentElement.classList.add('placeholder'); this.style.display='none';">
                        <div class="placeholder-text">
                            <i class="fas fa-user"></i>
                            <span>Samuel</span>
                        </div>
                        <div class="photo-overlay">
                            <span class="name-overlay">Samuel</span>
                        </div>
                    </div>
                    
                    <!-- Badge circular central com cora√ß√£o -->
                    <div class="circular-badge">
                        <div class="heart-icon">üíï</div>
                        <div class="badge-date">15 SET</div>
                        <div class="badge-year">2024</div>
                        <div class="save-date">Save the Date</div>
                    </div>
                    
                    <div class="photo-frame iara-frame">
                        <img src="/static/images/iara-photo.jpg" alt="Iara" onerror="this.parentElement.classList.add('placeholder'); this.style.display='none';">
                        <div class="placeholder-text">
                            <i class="fas fa-user"></i>
                            <span>Iara</span>
                        </div>
                        <div class="photo-overlay">
                            <span class="name-overlay">Iara</span>
                        </div>
                    </div>
                
                <!-- Se√ß√£o de texto -->
                <div class="text-section">
                    {% if nome_convidado %}
                    <div class="mensagem-personalizada">
                        <i class="fas fa-heart"></i>
                        <p>Ol√°, <strong>{{ nome_convidado }}</strong>!</p>
                        <p class="texto-especial">Este convite foi feito especialmente para voc√™ üíï</p>
                    </div>
                    {% endif %}
                    
                    <p class="subtitle-elegant">Nosso Casamento</p>
                    <h1 class="names-elegant">Samuel & Iara</h1>
                    <p class="invitation-text">
                        T√™m o prazer de convid√°-lo(a) para celebrar nossa uni√£o
                    </p>
                    
                    <!-- Detalhes do evento -->
                    <div class="event-details">
                        <div class="event-date">S√°bado, 15 de Setembro de 2024</div>
                        <div class="event-time">√†s 18:00 horas</div>
                        <div class="event-location">
                            Igreja S√£o Jos√©<br>
                            Rua das Flores, 123 - Centro, S√£o Paulo - SP
                        </div>
                    </div>
                </div>
                
                <!-- Bot√£o para abrir -->
                <div class="convite-action">
                    <button class="btn-abrir-convite" onclick="abrirConvite()">
                        <i class="fas fa-envelope-open"></i>
                        <span>Abrir Convite</span>
                    </button>
                </div>
            </div>
        </div>
    </div> <!-- Fim convite-personalizado -->
                <div class="envelope-body-main">
                    <!-- Aba traseira fechada -->
                    <div class="envelope-back-flap"></div>
                    
                    <!-- Frente do envelope -->
                    <div class="envelope-front-face">
                        <!-- Textura do papel -->
                        <div class="paper-texture"></div>
                        
                        <!-- Bras√£o em cera -->
                        <div class="wax-seal">
                            <div class="wax-circle">
                                <div class="wax-impression">
                                    <span class="initial-left">S</span>
                                    <div class="heart-separator">‚ô•</div>
                                    <span class="initial-right">I</span>
                                </div>
                                <div class="wax-drips"></div>
                            </div>
                        </div>
                        
                        <!-- Dobras laterais */
                        <div class="envelope-side-left"></div>
                        <div class="envelope-side-right"></div>
                    </div>
                    
                    <!-- Aba superior triangular */
                    <div class="envelope-top-flap">
                        <div class="flap-fold-line"></div>
                        <div class="flap-shadow"></div>
                    </div>
                </div>
                
                <!-- Bot√£o para abrir -->
                <div class="envelope-open-action">
                    <button class="btn-open-realistic" onclick="abrirConvite()">
                        <div class="btn-icon">
                            <i class="fas fa-envelope-open"></i>
                        </div>
                        <span class="btn-text">Abrir Carta</span>
                        <div class="btn-shine"></div>
                    </button>
                </div>
            </div>
        </div>
    </div> <!-- Fim convite-personalizado -->

    <!-- Carta do Convite (sempre dispon√≠vel) -->
    <div class="carta-content" id="carta" style="display: none;">
        <div class="carta-header">
            <div class="ornamento-top"></div>
            <h2 class="titulo-casamento">Nosso Casamento</h2>
            <div class="coracao">‚ù§Ô∏è</div>
        </div>

        <div class="carta-body">
            <div class="secao-nomes">
                <h1 class="nomes-principais">Samuel & Iara</h1>
                <p class="subtitulo">T√™m o prazer de convid√°-lo(a) para celebrar nossa uni√£o</p>
            </div>

            <div class="secao-data" id="secao-data">
                <div class="info-evento">
                    <h3><i class="fas fa-calendar-alt"></i> Data & Hor√°rio</h3>
                    <div class="data-info">
                        <p class="data">S√°bado, 15 de Setembro de 2024</p>
                        <p class="horario">√†s 18:00 horas</p>
                    </div>
                    <button class="btn-acao btn-destacado" onclick="mostrarLocal()">
                        <i class="fas fa-map-marker-alt"></i>
                        Ver Local da Cerim√¥nia
                    </button>
                </div>
            </div>

            <div class="secao-local" id="secao-local" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-church"></i> Local da Cerim√¥nia</h3>
                    <div class="local-info">
                        <p class="nome-local">Igreja S√£o Jos√©</p>
                        <p class="endereco">Rua das Flores, 123 - Centro<br>S√£o Paulo - SP</p>
                    </div>
                    <div class="mapa-container">
                        <div id="mapa" style="height: 300px; border-radius: 10px;"></div>
                    </div>
                    <div class="acoes-local">
                        <button class="btn-acao" onclick="abrirGoogleMaps()">
                            <i class="fas fa-directions"></i>
                            Como Chegar
                        </button>
                        <button class="btn-acao" onclick="mostrarConfirmacao()">
                            <i class="fas fa-heart"></i>
                            Confirmar Presen√ßa
                        </button>
                        <button class="btn-acao btn-voltar" onclick="voltarAoInicio()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-recepcao" id="secao-recepcao" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-glass-cheers"></i> Recep√ß√£o</h3>
                    <div class="local-info">
                        <p class="nome-local">Sal√£o de Festas Elegance</p>
                        <p class="endereco">Av. dos Noivos, 456 - Jardim Felicidade<br>S√£o Paulo - SP</p>
                        <p class="horario-recepcao">A partir das 19:30</p>
                    </div>
                    <div class="acoes-recepcao">
                        <button class="btn-acao" onclick="abrirGoogleMapsRecepcao()">
                            <i class="fas fa-directions"></i>
                            Como Chegar
                        </button>
                        <button class="btn-acao" onclick="mostrarPresentes()">
                            <i class="fas fa-gift"></i>
                            Ver Lista de Presentes
                        </button>
                        <button class="btn-acao btn-voltar" onclick="mostrarConfirmacao()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                    </div>
                </div>
            </div>

                <div class="secao-confirmacao" id="secao-confirmacao" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-heart"></i> Confirma√ß√£o de Presen√ßa</h3>
                    <form id="form-confirmacao" class="form-confirmacao">
                        {% if link_convite %}
                        <input type="hidden" name="link_convite" value="{{ link_convite }}">
                        {% endif %}
                        
                        <div class="form-group">
                            <label for="nome">Nome Completo:</label>
                            <input type="text" id="nome" name="nome" required 
                                   value="{{ nome_convidado if nome_convidado else '' }}" 
                                   {% if nome_convidado %}readonly class="campo-readonly"{% endif %}>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">E-mail (opcional):</label>
                            <input type="email" id="email" name="email" 
                                   value="{{ email_convidado if email_convidado else '' }}">
                        </div>
                        
                        <div class="form-group">
                            <label for="telefone">WhatsApp/Telefone (opcional):</label>
                            <input type="tel" id="telefone" name="telefone">
                        </div>
                        
                        <div class="form-group">
                            <label>Confirma sua presen√ßa?</label>
                            <div class="radio-group">
                                <label class="radio-label-custom">
                                    <input type="radio" name="presenca" value="true" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Sim, estarei presente! üéâ</span>
                                </label>
                                <label class="radio-label-custom">
                                    <input type="radio" name="presenca" value="false" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Infelizmente n√£o poderei comparecer üò¢</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="acompanhantes">N√∫mero de acompanhantes:</label>
                            <select id="acompanhantes" name="acompanhantes">
                                <option value="0">Apenas eu</option>
                                <option value="1">1 acompanhante</option>
                                <option value="2">2 acompanhantes</option>
                                <option value="3">3 acompanhantes</option>
                                <option value="4">4 ou mais acompanhantes</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes (opcional):</label>
                            <textarea id="observacoes" name="observacoes" rows="3" placeholder="Alguma restri√ß√£o alimentar ou observa√ß√£o especial?"></textarea>
                        </div>
                        
                        <div class="acoes-confirmacao">
                            <button type="submit" class="btn-confirmar btn-destacado">
                                <i class="fas fa-check"></i>
                                Confirmar Presen√ßa
                            </button>
                            <button type="button" class="btn-acao btn-voltar" onclick="mostrarLocal()">
                                <i class="fas fa-arrow-left"></i>
                                Voltar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="secao-presentes" id="secao-presentes" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-gift"></i> Lista de Presentes</h3>
                    <p class="texto-presentes">
                        Sua presen√ßa √© o presente mais importante para n√≥s! <br>
                        Mas se desejar nos presentear, preparamos uma lista especial:
                    </p>
                    <div class="acoes-presentes">
                        <a href="{{ url_for('presentes') }}" class="btn-presentes" target="_blank">
                            <i class="fab fa-amazon"></i>
                            Ver Lista de Presentes
                        </a>
                        <button class="btn-acao" onclick="mostrarAgradecimentos()">
                            <i class="fas fa-heart"></i>
                            Mensagem Final
                        </button>
                        <button class="btn-acao btn-voltar" onclick="mostrarConfirmacao()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-agradecimentos" id="secao-agradecimentos" style="display: none;">
                <div class="info-evento final">
                    <div class="coracao-grande">üíï</div>
                    <h3>Obrigado!</h3>
                    <p class="mensagem-final">
                        Esperamos celebrar este momento especial ao seu lado.<br>
                        Sua presen√ßa tornar√° nosso dia ainda mais especial!
                    </p>
                    <div class="assinatura">
                        <p>Com amor,<br><strong>Samuel & Iara</strong></p>
                    </div>
                    <button class="btn-acao" onclick="voltarAoInicio()">
                        <i class="fas fa-redo"></i>
                        Voltar ao In√≠cio
                    </button>
                    
                    <!-- Link discreto para administra√ß√£o -->
                    <div class="admin-access" style="margin-top: 30px; text-align: center;">
                        <a href="{{ url_for('admin_login') }}" class="admin-link">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- Fim convite-personalizado -->
    {% endif %}

    <!-- Carta do Convite (sempre dispon√≠vel) -->
    <div class="carta-content" id="carta" style="display: none;">
        <div class="carta-header">
            <div class="ornamento-top"></div>
            <h2 class="titulo-casamento">Nosso Casamento</h2>
            <div class="coracao">‚ù§Ô∏è</div>
        </div>

        <div class="carta-body">
            <div class="secao-nomes">
                <h1 class="nomes-principais">Samuel & Iara</h1>
                <p class="subtitulo">T√™m o prazer de convid√°-lo(a) para celebrar nossa uni√£o</p>
            </div>

            <div class="secao-data" id="secao-data">
                <div class="info-evento">
                    <h3><i class="fas fa-calendar-alt"></i> Data & Hor√°rio</h3>
                    <div class="data-info">
                        <p class="data">S√°bado, 15 de Setembro de 2024</p>
                        <p class="horario">√†s 18:00 horas</p>
                    </div>
                    <button class="btn-acao btn-destacado" onclick="mostrarLocal()">
                        <i class="fas fa-map-marker-alt"></i>
                        Ver Local da Cerim√¥nia
                    </button>
                </div>
            </div>

            <div class="secao-local" id="secao-local" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-church"></i> Local da Cerim√¥nia</h3>
                    <div class="local-info">
                        <p class="nome-local">Igreja S√£o Jos√©</p>
                        <p class="endereco">Rua das Flores, 123 - Centro<br>S√£o Paulo - SP</p>
                    </div>
                    <div class="mapa-container">
                        <div id="mapa" style="height: 300px; border-radius: 10px;"></div>
                    </div>
                    <div class="acoes-local">
                        <button class="btn-acao" onclick="abrirGoogleMaps()">
                            <i class="fas fa-directions"></i>
                            Como Chegar
                        </button>
                        <button class="btn-acao" onclick="mostrarConfirmacao()">
                            <i class="fas fa-heart"></i>
                            Confirmar Presen√ßa
                        </button>
                        <button class="btn-acao btn-voltar" onclick="voltarAoInicio()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-confirmacao" id="secao-confirmacao" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-heart"></i> Confirmar Presen√ßa</h3>
                    <form class="form-confirmacao" id="form-confirmacao">
                        {% if link_convite %}
                        <input type="hidden" name="link_convite" value="{{ link_convite }}">
                        {% endif %}
                        
                        <div class="form-group">
                            <label for="nome">Nome Completo:</label>
                            <input type="text" id="nome" name="nome" required 
                                   value="{{ nome_convidado if nome_convidado else '' }}" 
                                   {% if nome_convidado %}readonly class="campo-readonly"{% endif %}>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">E-mail (opcional):</label>
                            <input type="email" id="email" name="email" 
                                   value="{{ email_convidado if email_convidado else '' }}">
                        </div>
                        
                        <div class="form-group">
                            <label for="telefone">Telefone/WhatsApp (opcional):</label>
                            <input type="tel" id="telefone" name="telefone">
                        </div>
                        
                        <div class="form-group">
                            <label>Confirma√ß√£o de Presen√ßa:</label>
                            <div class="radio-group">
                                <label class="radio-label-custom">
                                    <input type="radio" name="confirmacao" value="sim" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Sim, estarei presente! üéâ</span>
                                </label>
                                <label class="radio-label-custom">
                                    <input type="radio" name="confirmacao" value="nao" required>
                                    <span class="radio-custom"></span>
                                    <span class="radio-text">Infelizmente n√£o poderei comparecer üò¢</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="acompanhantes-group" style="display: none;">
                            <label for="acompanhantes">N√∫mero de acompanhantes:</label>
                            <select id="acompanhantes" name="acompanhantes">
                                <option value="0">Apenas eu</option>
                                <option value="1">Eu + 1 pessoa</option>
                                <option value="2">Eu + 2 pessoas</option>
                                <option value="3">Eu + 3 pessoas</option>
                                <option value="4">Eu + 4 pessoas</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes (opcional):</label>
                            <textarea id="observacoes" name="observacoes" rows="3" 
                                      placeholder="Alguma observa√ß√£o especial, restri√ß√£o alimentar, etc."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-acao btn-destacado">
                                <i class="fas fa-heart"></i>
                                Confirmar Presen√ßa
                            </button>
                            <button type="button" class="btn-acao btn-secundario" onclick="mostrarPresentes()">
                                <i class="fas fa-gift"></i>
                                Ver Lista de Presentes
                            </button>
                            <button type="button" class="btn-acao btn-voltar" onclick="mostrarLocal()">
                                <i class="fas fa-arrow-left"></i>
                                Voltar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="secao-presentes" id="secao-presentes" style="display: none;">
                <div class="info-evento">
                    <h3><i class="fas fa-gift"></i> Lista de Presentes</h3>
                    <p class="texto-presentes">
                        Sua presen√ßa √© o nosso maior presente, mas se desejar nos presentear, 
                        fizemos uma lista especial na Amazon:
                    </p>
                    <div class="presentes-container" id="presentes-container">
                        <!-- Presentes ser√£o carregados dinamicamente -->
                    </div>
                    <div class="acoes-presentes">
                        <button class="btn-acao" onclick="mostrarAgradecimentos()">
                            <i class="fas fa-heart"></i>
                            Mensagem Final
                        </button>
                        <button class="btn-acao btn-voltar" onclick="mostrarConfirmacao()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </button>
                    </div>
                </div>
            </div>

            <div class="secao-agradecimentos" id="secao-agradecimentos" style="display: none;">
                <div class="info-evento final">
                    <div class="coracao-grande">üíï</div>
                    <h3>Obrigado!</h3>
                    <p class="mensagem-final">
                        Esperamos celebrar este momento especial ao seu lado.<br>
                        Sua presen√ßa tornar√° nosso dia ainda mais especial!
                    </p>
                    <div class="assinatura">
                        <p>Com amor,<br><strong>Samuel & Iara</strong></p>
                    </div>
                    <button class="btn-acao" onclick="voltarAoInicio()">
                        <i class="fas fa-redo"></i>
                        Voltar ao In√≠cio
                    </button>
                    
                    <!-- Link discreto para administra√ß√£o -->
                    <div class="admin-access" style="margin-top: 30px; text-align: center;">
                        <a href="{{ url_for('admin_login') }}" class="admin-link">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Sucesso -->
<div id="modal-sucesso" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <div class="modal-body">
            <i class="fas fa-check-circle modal-icon"></i>
            <h3>Confirma√ß√£o Enviada!</h3>
            <p>Obrigado por confirmar sua presen√ßa. Aguardamos voc√™ em nosso grande dia!</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Vari√°veis globais
let convidadoAtual = {% if convidado %}{{ {'id': convidado.id, 'nome': convidado.nome, 'whatsapp': convidado.whatsapp, 'codigo_convite': convidado.codigo_convite, 'status_resposta': convidado.status_resposta}|tojson }}{% else %}null{% endif %};
let abrirMensagemFinal = {% if abrir_mensagem_final %}true{% else %}false{% endif %};

// Configura√ß√£o do Google Maps
const coordenadas = {
    cerimonia: { lat: -23.5330, lng: -46.6396 }, // Igreja S√£o Jos√© - S√£o Paulo/SP
    recepcao: { lat: -23.5320, lng: -46.6380 }   // Local pr√≥ximo para recep√ß√£o
};

// Identifica√ß√£o de convidado
document.addEventListener('DOMContentLoaded', function() {
    const formIdentificacao = document.getElementById('form-identificacao');
    if (formIdentificacao) {
        formIdentificacao.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const identificador = document.getElementById('identificador').value.trim();
            
            if (!identificador) {
                alert('Por favor, informe seu nome ou WhatsApp');
                return;
            }
            
            try {
                const response = await fetch('/identificar_convidado', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ identificador: identificador })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    if (result.ja_confirmou) {
                        // Redirecionar para resumo
                        window.location.href = `/resumo/${result.codigo}`;
                    } else {
                        // Redirecionar para convite personalizado
                        window.location.href = `/?codigo=${result.codigo}`;
                    }
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('Erro ao buscar convidado. Tente novamente.');
            }
        });
    }
});

function continuarGenerico() {
    // Esconder tela de identifica√ß√£o e mostrar convite gen√©rico
    document.getElementById('identificacao').style.display = 'none';
    document.getElementById('envelope').style.display = 'block';
}

function initMap() {
    // Criar mapa din√¢mico usando Google Maps API
    const mapContainer = document.getElementById("mapa");
    if (mapContainer) {
        mapContainer.innerHTML = "";
        var map = new google.maps.Map(mapContainer, {
            center: {lat: {{ latitude }}, lng: {{ longitude }}},
            zoom: 16
        });
        new google.maps.Marker({
            position: {lat: {{ latitude }}, lng: {{ longitude }}},
            map: map,
            title: '{{ nome_local }}'
        });
        mapContainer.style.display = "block";
    }
<script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}"></script>
}

// Fun√ß√µes de navega√ß√£o
function esconderTodasSecoes() {
    // Esconder todas as se√ß√µes
    document.querySelectorAll('.secao-data, .secao-local, .secao-recepcao, .secao-confirmacao, .secao-presentes, .secao-agradecimentos').forEach(el => {
        el.style.display = 'none';
    });
}

function abrirConvite() {
    document.getElementById('envelope').style.display = 'none';
    document.getElementById('carta').style.display = 'block';
    
    // Se deve abrir direto na mensagem final (quem n√£o comparecer√°)
    if (abrirMensagemFinal || (convidadoAtual && convidadoAtual.status_resposta === 'nao_comparecera')) {
        esconderTodasSecoes();
        document.getElementById('secao-agradecimentos').style.display = 'block';
        document.getElementById('secao-agradecimentos').scrollIntoView({ behavior: 'smooth' });
    } else {
        // Mostrar apenas a primeira se√ß√£o (data)
        esconderTodasSecoes();
        document.getElementById('secao-data').style.display = 'block';
    }
}

function mostrarLocal() {
    esconderTodasSecoes();
    document.getElementById('secao-local').style.display = 'block';
    document.getElementById('secao-local').scrollIntoView({ behavior: 'smooth' });
    // Inicializar o mapa ap√≥s mostrar a se√ß√£o
    setTimeout(initMap, 500);
}

function mostrarRecepcao() {
    esconderTodasSecoes();
    document.getElementById('secao-recepcao').style.display = 'block';
    document.getElementById('secao-recepcao').scrollIntoView({ behavior: 'smooth' });
}

function mostrarConfirmacao() {
    esconderTodasSecoes();
    document.getElementById('secao-confirmacao').style.display = 'block';
    document.getElementById('secao-confirmacao').scrollIntoView({ behavior: 'smooth' });
}

function mostrarPresentes() {
    esconderTodasSecoes();
    document.getElementById('secao-presentes').style.display = 'block';
    document.getElementById('secao-presentes').scrollIntoView({ behavior: 'smooth' });
}

function mostrarAgradecimentos() {
    esconderTodasSecoes();
    document.getElementById('secao-agradecimentos').style.display = 'block';
    document.getElementById('secao-agradecimentos').scrollIntoView({ behavior: 'smooth' });
}

function voltarAoInicio() {
    // Voltar para a primeira se√ß√£o (data)
    esconderTodasSecoes();
    document.getElementById('secao-data').style.display = 'block';
    document.getElementById('secao-data').scrollIntoView({ behavior: 'smooth' });
}

function abrirGoogleMaps() {
    const url = `https://maps.google.com/?q=${coordenadas.cerimonia.lat},${coordenadas.cerimonia.lng}`;
    window.open(url, '_blank');
}

function abrirGoogleMapsRecepcao() {
    const url = `https://maps.google.com/?q=${coordenadas.recepcao.lat},${coordenadas.recepcao.lng}`;
    window.open(url, '_blank');
}

// Formul√°rio de confirma√ß√£o
document.getElementById('form-confirmacao').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const confirmouPresenca = formData.get('presenca') === 'true';
    const data = {
        nome: formData.get('nome'),
        telefone: formData.get('telefone'),
        confirmou_presenca: confirmouPresenca,
        acompanhantes: parseInt(formData.get('acompanhantes')),
        observacoes: formData.get('observacoes'),
        codigo_convite: convidadoAtual ? convidadoAtual.codigo_convite : null
    };
    
    try {
        const response = await fetch('/api/confirmar-presenca', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('modal-sucesso').style.display = 'block';
            this.reset();
            // Ap√≥s fechar o modal, verificar o tipo de resposta
            setTimeout(() => {
                document.getElementById('modal-sucesso').style.display = 'none';
                if (confirmouPresenca && result.codigo) {
                    // Se confirmou presen√ßa e tem c√≥digo, ir para resumo
                    window.location.href = `/resumo/${result.codigo}`;
                } else if (!confirmouPresenca && result.codigo) {
                    // Se n√£o comparecer√° e tem c√≥digo, ir para mensagem final
                    esconderTodasSecoes();
                    document.getElementById('secao-agradecimentos').style.display = 'block';
                    document.getElementById('secao-agradecimentos').scrollIntoView({ behavior: 'smooth' });
                } else {
                    // Sen√£o, ir para presentes
                    mostrarPresentes();
                }
            }, 3000);
        } else {
            alert('Erro ao enviar confirma√ß√£o: ' + result.message);
        }
    } catch (error) {
        alert('Erro ao enviar confirma√ß√£o. Tente novamente.');
    }
});

function fecharModal() {
    document.getElementById('modal-sucesso').style.display = 'none';
}

// Fechar modal clicando fora dele
window.onclick = function(event) {
    const modal = document.getElementById('modal-sucesso');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>

<!-- Script do Google Maps -->
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_DO_GOOGLE_MAPS&callback=initMap">
</script>
{% endblock %}
